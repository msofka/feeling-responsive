---
layout: pagewide
title: "Hierarchical Detection Network (HDN)"
subheadline: ""
show_meta: false
articlename: "Hierarchical Detection Network (HDN)"
teaser: ""
noheading: "true"
permalink: "/projects/hdn/"
header:
    image_fullwidth: "header_unsplash_railroad.jpg"
---

      <h5 class="navigatorButtons"><a href="/projects/">Projects</a> / <a href="/projects/#imga">Image Analysis</a> / {{ page.articlename }} </h5>
   <TABLE class="container-fluid" style="border:0;background-color:transparent;">
     <TR>
       <TD style="padding: 10 10 10 10; vertical-align: top">
         <p class=cap>Multiple Object Detection by Sequential Monte Carlo
                  and Hierarchical Detection Network (HDN)</p>
         <p class=text><i>This page gives a high level overview of our research on Hierarchical Detection Network (HDN).
         For more details, please refer to <A HREF="#sofka:cvpr10">our article</A>
         published in CVPR 2010 proceedings.</i></p>


         <p class=text><b>Contents</b></p>
         <UL class=text>
         <LI type="square"><A HREF="#overview">Overview</A>
         <LI type="square"><A HREF="#motivation">Motivation and Intuition</A>
         <LI type="square"><A HREF="#results">Results</A>
         <LI type="square"><A HREF="#summary">Summary</A>
         <LI type="square"><A HREF="#bibliography">Bibliography</A>
         </UL>

         <p class=text><b><A NAME="overview">Overview</A></b></p>
         <p class=text>
In this paper, we propose a novel framework for detecting multiple objects in 2D and 3D images. Since a joint multi-object model is difficult to obtain in most practical situations, we focus here on detecting the objects sequentially, one-by-one. The interdependence of object poses and strong prior information embedded in our domain of medical images results in better performance than detecting the objects individually. Our approach is based on Sequential Estimation techniques, frequently applied to visual tracking. Unlike in tracking, where the sequential order is naturally determined by the time sequence, the order of detection of multiple objects must be selected, leading to a Hierarchical Detection Network (HDN). We present an algorithm that optimally selects the order based on probability of states (object poses) within the ground truth region. The posterior distribution of the object pose is approximated at each step by sequential Monte Carlo. The samples are propagated within the sequence across multiple objects and hierarchical levels. We show on 2D ultrasound images of left atrium, that the automatically selected sequential order yields low mean detection error. We also quantitatively evaluate the hierarchical detection of fetal faces and three fetal brain structures in 3D ultrasound images.


         <p class=text><b><A NAME="motivation">Motivation and Intuition</A></b></p>
         <p class=text>
     The most challenging aspect
     of the multi-object detection algorithms is designing detectors that are fast
     and robust, modeling the spatial relationships between
     objects, and determining the detection order. In this paper, we
     propose a multi-object detection system that addresses these
     challenges.

      <p class=text>
The computational speed and robustness of our system is
increased by hierarchical processing. In detection, one major
problem is how to effectively propagate object candidates
across the levels of the hierarchy. This typically involves
defining a search range at a fine level where the candidates
from the coarse level are refined. Incorrect selection of
the search range leads to higher computational speeds,
lower accuracy, or drift of the coarse candidates towards
incorrect refinements. The search range in our technique is part
of the model that is learned from the training data. Furthermore, our
detection schedule is designed to minimize the
uncertainty of the detections and optimally select schedule of the hierarchical
scales.

         <DIV ALIGN="CENTER">
         <TABLE>
         <CAPTION ALIGN="BOTTOM">
         <p class=text><STRONG>Figure 1:</STRONG>
         Examples of multi-object detection: five landmarks of left atrium (LA) apical two chamber (A2C)
    view (left) and 3D ultrasound volume of fetal brain with three anatomies (right).
         </CAPTION>
         <TR><TD>
         <IMG ALT="left atrium" HEIGHT=150 ALIGN="BOTTOM" BORDER="0" SRC="/HDN/071706Eval_c018.png">
    <IMG ALT="US volume" HEIGHT=150 ALIGN="BOTTOM" BORDER="0" SRC="/HDN/SI_Volume_high_res.png">
    <IMG ALT="fetal brain structures" HEIGHT=150 ALIGN="BOTTOM" BORDER="0" SRC="/HDN/SIplanes.png">
         </TD></TR>
         </TABLE>
         </DIV>

<p class=text>
Our approach to multi-object detection is motivated by Sequential Estimation
techniques, frequently applied to visual tracking.
We sample from a sequence of
probability distributions, but the sequence specifies a spatial
order rather than a time order in tracking. The posterior
distribution of each object pose (state) is estimated based
on all observations so far. The observations are features
computed from image neighborhoods surrounding the objects.
The likelihood of a hypothesized state that gives rise to
observations is based on a deterministic model learned using a
large annotated database of images. The transition model
that describes the way the poses of objects are related is
Gaussian.

<p class=text>
Employing the sequential sampling
model allows us to use fewer samples of the object pose and
formally extend this class of algorithms to multiple objects. This
saves computational time and increases accuracy since the samples are taken from the regions of high probability of the
     posterior distribution. Many ideas from the Sequential
     Sampling literature on visual tracking can likely be extended to
     multi-object detection. We demonstrate the
     benefit of the sampling when detecting multiple landmarks in
     2D images of the left atrium. Unlike in tracking, where
     the sequential order is naturally determined by the time
     progression, the order in multi-object detection must be
     selected. In our algorithm, the order is selected such that the
     uncertainty of the detections is minimized. So, instead of
     using the immediate precursor in the Markov process, the
     transition model could be based on any precursor, which is
     optimally selected. This leads to a Hierarchical Detection
     Network (HDN). The likelihood of a hypothesized pose is
     computed using a trained detector. The detection scale is
     introduced as another parameter of the likelihood model and the
     hierarchical schedule is determined in the same way as the
     spatial schedule.



         <p class=text><b><A NAME="results">Results</A></b></p>
         <p class=text>
The goal is to automatically determine the detection order of five left atrium
landmarks. The landmark detectors are
trained independently using 281 annotated images. Total of 46
annotated images from the testing data set were used to obtain
the detection order. The remaining 90 cases were used for
detection and evaluation comparison.

         <DIV ALIGN="CENTER">
         <TABLE>
         <CAPTION ALIGN="BOTTOM">
         <p class=text><STRONG>Figure 2:</STRONG>
         The final automatically selected detection order.  At first, it might seem that landmarks 01 and 17 would be preferred over landmarks 5 and 13 due to the higher distinctiveness of the region.  However, the high appearance variation of these landmarks causes preference of landmarks 05 and 13.
         </CAPTION>
         <TR><TD>
         <IMG ALT="left atrium landmarks detection order" ALIGN="BOTTOM" BORDER="0" SRC="/HDN/final_order.jpg">
         </TD></TR>
         </TABLE>
         </DIV>

         <p class=text>
Our next experiment is on detecting three fetal brain structures
in 3d ultrasound data. The output of the system is a visualization
of the plane with correct orientation and centering as well as
biometric measurement of the anatomy. A total of 589
expert-annotated images were used for training and 295 for
testing. The volumes have average size <span
class="cmr-10">250 </span><span
class="cmsy-10">&#x00D7; </span><span
class="cmr-10">200 </span><span
class="cmsy-10">&#x00D7; </span><span
class="cmr-10">150 </span>mm.
We use three resolutions in a hierarchical system shown in
Figure 3.


Quantitative evaluation is in Table 1 and several examples of
detected structures in Figure 3. The HDN average detection
error 2.2 mm is lower compared to 4.8 mm error of a system
without HDN.

         <DIV ALIGN="CENTER">
         <TABLE>
         <CAPTION ALIGN="BOTTOM">
         <p class=text><STRONG>Figure 3:</STRONG>
         The detection order and the hierarchy of three brain structures: Cerebellum (CER), Cisterna Magna (CM), and Lateral Ventricles (LV).
    Scale selection is applied.
         </CAPTION>
         <TR><TD>
         <IMG ALT="fetal head detection order" HEIGHT=170 ALIGN="BOTTOM" BORDER="0" SRC="/HDN/SIdiagram.jpg">
         </TD></TR>
         </TABLE>
         </DIV>


    <DIV ALIGN="CENTER">
         <TABLE>
         <CAPTION ALIGN="BOTTOM">
         <p class=text><STRONG>Table 1:</STRONG>
         Measurement errors of the hierarchical detection
system  (top  part  of  the  table)  compared  to  an  earlier
system  without  the  hierarchy.  Mean  error,  standard
deviation, median error, and maximum error are computed.
The system was trained using number of volumes specified
in  the  6th  column  and  tested  on  the  number  of  volumes
specified  in  the  7th  column.  The  average  detection  error
using  the  hierarchy  is  2.2  mm  on  data  with  1  mm  finest
resolution.  The  average  error  of  the  system  without  the
hierarchy is 4.8 mm.
         </CAPTION>
    <TR><TD>
      <table cellspacing=10>
      <TR>
      <TD>  	 </TD>  <TD>   mean	 </TD>  <TD>   std	 </TD>  <TD>   median	 </TD>  <TD>   max  </TD>  <TD>  #train  </TD>  <TD>  #test  </TD>
   </TR>
   <TR>
      <TD> CER	 </TD>  <TD>   2.289	 </TD>  <TD>   0.884	 </TD>  <TD>   2.213	 </TD>  <TD>   4.197  </TD>  <TD>  589  </TD>  <TD>  295  </TD>
   </TR>
   <TR>
      <TD> CM	 </TD>  <TD>   2.149	 </TD>  <TD>   0.807	 </TD>  <TD>   2.075	 </TD>  <TD>   4.019  </TD>  <TD>  589  </TD>  <TD>  295  </TD>
   </TR>
   <TR>
      <TD> LV	 </TD>  <TD>   2.245	 </TD>  <TD>   0.817	 </TD>  <TD>   2.154	 </TD>  <TD>   3.891  </TD>  <TD>  589  </TD>  <TD>  295  </TD>
   </TR>
   <TR>
   </TR>
   <TR>
      <TD> CER  </TD>  <TD>   4.961   </TD>  <TD>   6.767   </TD>  <TD>   3.422   </TD>  <TD>   59.607  </TD>  <TD>  589  </TD>  <TD>  295 </TD>
   </TR>
   <TR>
      <TD> CM  </TD>  <TD>   4.989   </TD>  <TD>   6.832   </TD>  <TD>   3.519   </TD>  <TD>   68.679  </TD>  <TD>  589  </TD>  <TD>  295  </TD>
   </TR>
   <TR>
      <TD> LV  </TD>  <TD>   4.565   </TD>  <TD>   5.023   </TD>  <TD>   3.097   </TD>  <TD>   39.176  </TD>  <TD>  589  </TD>  <TD>  295  </TD>
   </TR>
   </table>

      </TD></TR>
         </TABLE>
         </DIV>


         <DIV ALIGN="CENTER">
         <TABLE>
         <CAPTION ALIGN="BOTTOM">
         <p class=text><STRONG>Figure 3:</STRONG>
         Final sequential detection result (cyan) compared to ground truth (red).  Notice that the landmarks are accurately detected despite the noise, high appearance and shape variations, and shadowing effects. The landmark detection errors (in pixels) are shown below each image in the left-bottom-right order.
          </CAPTION>

    <TR>
         <TD><IMG ALT="LA 1" ALIGN="BOTTOM" BORDER="0" SRC="/HDN/la/SF1146_29_IMG_0200.jpg"></TD>
         <TD><IMG ALT="LA 2" ALIGN="BOTTOM" BORDER="0" SRC="/HDN/la/17525.jpg"></TD>
         <TD><IMG ALT="LA 3" ALIGN="BOTTOM" BORDER="0" SRC="/HDN/la/53832.jpg"></TD>
         <TD><IMG ALT="LA 4" ALIGN="BOTTOM" BORDER="0" SRC="/HDN/la/98426.jpg"></TD>
    </TR>
    <TR>
    <TD><p class=text>(6.39, 6.91, 4.64, 7.21, 6.26)</TD>
    <TD><p class=text>(2.42, 6.84, 9.95, 7.33, 8.41)</TD>
    <TD><p class=text>(7.94, 5.03, 7.03, 8.18, 5.00)</TD>
    <TD><p class=text>(5.24, 9.83, 6.16, 5.12, 7.71)</TD>
    </TR>
         </TABLE>
         </DIV>



    <DIV ALIGN="CENTER">
         <TABLE>
         <CAPTION ALIGN="BOTTOM">
         <p class=text><STRONG>Figure 4:</STRONG>
         Final hierarchical detection result (cyan) compared to ground truth (red). The last two columns show
    the agreement of the detection plane in the sagittal and coronal cross section.
          </CAPTION>

    <TR>
         <TD><IMG ALT="fetal head 1" ALIGN="BOTTOM" HEIGHT=170 BORDER="0" SRC="/HDN/fetal_brain/MOMMY_CW_30W_CER_CER.jpg"></TD>
         <TD><IMG ALT="fetal head 2" ALIGN="BOTTOM" HEIGHT=170 BORDER="0" SRC="/HDN/fetal_brain/MOMMY_CW_30W_CER_GT_CER.jpg"></TD>
         <TD><IMG ALT="fetal head 3" ALIGN="BOTTOM" HEIGHT=170 BORDER="0" SRC="/HDN/fetal_brain/MOMMY_CW_30W_CER_FRN_GT_CER.jpg"></TD>
         <TD><IMG ALT="fetal head 4" ALIGN="BOTTOM" HEIGHT=170 BORDER="0" SRC="/HDN/fetal_brain/MOMMY_CW_30W_CER_PRF_GT_CER.jpg"></TD>
    </TR>
    <TR>
         <TD><IMG ALT="fetal head 1" ALIGN="BOTTOM" HEIGHT=170 BORDER="0" SRC="/HDN/fetal_brain/MOMMY_CW_30W_CM_CM.jpg"></TD>
         <TD><IMG ALT="fetal head 2" ALIGN="BOTTOM" HEIGHT=170 BORDER="0" SRC="/HDN/fetal_brain/MOMMY_CW_30W_CM_GT_CM.jpg"></TD>
         <TD><IMG ALT="fetal head 3" ALIGN="BOTTOM" HEIGHT=170 BORDER="0" SRC="/HDN/fetal_brain/MOMMY_CW_30W_CM_FRN_GT_CM.jpg"></TD>
         <TD><IMG ALT="fetal head 4" ALIGN="BOTTOM" HEIGHT=170 BORDER="0" SRC="/HDN/fetal_brain/MOMMY_CW_30W_CM_PRF_GT_CM.jpg"></TD>
    </TR>
    <TR>
         <TD><IMG ALT="fetal head 1" ALIGN="BOTTOM" HEIGHT=170 BORDER="0" SRC="/HDN/fetal_brain/MOMMY_CW_30W_LV_LV.jpg"></TD>
         <TD><IMG ALT="fetal head 2" ALIGN="BOTTOM" HEIGHT=170 BORDER="0" SRC="/HDN/fetal_brain/MOMMY_CW_30W_LV_GT_LV.jpg"></TD>
         <TD><IMG ALT="fetal head 3" ALIGN="BOTTOM" HEIGHT=170 BORDER="0" SRC="/HDN/fetal_brain/MOMMY_CW_30W_LV_FRN_GT_LV.jpg"></TD>
         <TD><IMG ALT="fetal head 4" ALIGN="BOTTOM" HEIGHT=170 BORDER="0" SRC="/HDN/fetal_brain/MOMMY_CW_30W_LV_PRF_GT_LV.jpg"></TD>
    </TR>

         </TABLE>
         </DIV>


         <p class=text><b><A NAME="summary">Summary</A></b></p>
         <p class=text>
We have presented a Sequential Monte Carlo based Hierarchical Detection Network (HDN) for detecting multiple objects. The order of detection is automatically determined by a greedy algorithm that puts the most reliable detections earlier in the detection sequence. The detectors are organized in a multi-scale hierarchy with the scale parameter included in the order selection process. We have shown the effectiveness of the automatic order selection process on the detection of five left atrium landmarks in 2D ultrasound images. The multi-scale hierarchical detectors have higher detection accuracy than systems based on a single level as we demonstrated on detection of fetal face and three fetal brain structures in 3D ultrasound images.

<p class=text>
The described framework opens up several possible avenues of future research. One area we are particularly interested in is how to include dependence on multiple objects at each detection stage. This will result in a stronger geometrical constraint and therefore improve performance on objects that are difficult to detect by exploiting only the pairwise dependence.



    <br>
         <p class=text><b><A NAME="bibliography">Publications and Further Reading</A></b></p>

         <TABLE>
         <TR>
           <TD style="padding: 0 0 15 0; vertical-align: top">
             <p class=text>
            Automatic Detection and Measurement of Structures in Fetal Head Ultrasound Volumes Using Sequential
            Estimation and Integrated Detection Network (IDN)<BR>
              Michal Sofka and Jingdan Zhang and Sara Good
                and S. Kevin Zhou and Dorin Comaniciu<BR>
            <I>IEEE Transactions on Medical Imaging (TMI), vol. 33, no. 5, pp. 1054-1070, May 2014.</I>
             <BR>
             <A HREF="/pdfs/sofka-tmi14.pdf">[pdf]</A>
             <A HREF="/pdfs/sofka-tmi14.bib">[bibtex]</A>
             <A HREF="http://dx.doi.org/10.1109/TMI.2014.2301936">[publisher]</A>
             </p>
           </TD>
         </TR>

         <TR>
           <TD style="padding: 0 0 15 0; vertical-align: top">
           <p class=text><A NAME="sofka:cvpr10">
            Multiple Object Detection by Sequential Monte Carlo and Hierarchical Detection Network</A><BR>
            Michal Sofka, Jingdan Zhang, S.Kevin Zhou, and Dorin Comaniciu<BR>
           <I>In Proceedings of the IEEE Conference on Computer Vision and Pattern Recognition, San Francisco, CA, USA, 2010.</I>
           <BR>
          <A HREF="/pdfs/sofka-cvpr10.pdf">[pdf]</A>
             <A HREF="/pdfs/sofka-cvpr10.bib">[bibtex]</A>
           </p>
           </TD>
         </TR>

         <TR>
           <TD style="padding: 0 0 15 0; vertical-align: top">
             <p class=text>
             Integrated Detection Network (IDN) for Pose and Boundary Estimation in Medical Images<BR>
              Michal Sofka, Kristof Ralovich, Neil Birkbeck, Jingdan Zhang, and S.Kevin Zhou<BR>
             <I>Proceedings of the 8th International Symposium on
             Biomedical Imaging (ISBI 2011), Chicago, IL, USA, 30 Mar-2 Apr 2011.</I>
             <BR>
            <A HREF="/pdfs/sofka-isbi11.pdf">[pdf]</A>
            <A HREF="/pdfs/sofka-isbi11.bib">[bibtex]</A>
            <A HREF="idn.html">[website]</A>
           </p>
           </TD>
         </TR>

         <TR>
           <TD style="padding: 0 0 15 0; vertical-align: top">
             <p class=text>
             Fast Boosting Trees for Classification, Pose Detection, and Boundary Detection on a GPU<BR>
              Neil Birkbeck, Michal Sofka, and S.Kevin Zhou<BR>
             <I>Proceedings of the 7th IEEE Workshop on Embedded Computer Vision (in conjunction with IEEE CVPR)
        Colorado Springs, CO, USA, 20 Jun 2011.</I>
             <BR>
        <A HREF="/pdfs/birkbeck-cvprw11.pdf">[pdf]</A>
        <A HREF="/pdfs/birkbeck-cvprw11.bib">[bibtex]</A>
             </p>
           </TD>
         </TR>

         </TABLE>

         <BR>
         <BR>
       </TD>
     </TR>
</TABLE>
